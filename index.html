<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OD Image Generator</title>
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#0f1520; color:#eee; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    h1 { margin:0 0 20px; text-align:center; }
    h2 { font-size:16px; margin:20px 0 8px; }
    select { width: 100%; padding:10px; border-radius:8px; border:1px solid #333; background:#0f1520; color:#eee; }
    textarea { width:100%; min-height:150px; margin-top:10px; border-radius:8px; border:1px solid #333; padding:10px; background:#0f1520; color:#eee; }
    button { padding:10px 16px; margin-top:10px; border:none; border-radius:8px; cursor:pointer; background:#1f7bf2; color:white; }
    .prompt-box { margin-top:8px; font-size:13px; color:#9ecbff; background:#121822; padding:8px; border-radius:6px; white-space:pre-wrap; }
    .radio-group { margin:8px 0; }
    .radio-group label { display:block; margin:4px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>OD Image Generator</h1>

    <h2>① Main Header（アニメ / リアル）</h2>
    <select id="selHeader"></select>
    <div id="headerPrompt" class="prompt-box"></div>

    <h2>② Intensity（シチュエーション）</h2>
    <select id="selIntensity"></select>
    <div id="intensityPrompt" class="prompt-box"></div>

    <h2>③ Emotion（表情・最大4つ選択可）</h2>
    <div id="emotionOptions" class="checkbox-group"></div>
    <div id="emotionPrompt" class="prompt-box"></div>

    <h2>④ Extra Elements（Eyes / Mouth / Tongue / Saliva / Pussy Juice）</h2>
    <div id="extraRadios"></div>
    <div id="extraPrompt" class="prompt-box"></div>

    <h2>⑤ 結合プロンプト</h2>
    <textarea id="out" readonly placeholder="ここに結合プロンプトが出力されます"></textarea>
    <button id="btnCopy">コピー</button>
    <span id="status"></span>

    <h2>⑥ Outfit（衣装）</h2>
    <select id="selOutfit"></select>
    <div id="outfitPrompt" class="prompt-box"></div>
    <button id="btnCopyOutfit">Outfitコピー</button>

    <h2>⑦ Accessory（複数選択可）</h2>
    <select id="selAccessory" multiple></select>
    <div id="accessoryPrompt" class="prompt-box"></div>
    <button id="btnCopyAccessory">Accessoryコピー</button>
  </div>

  <script>
    const $ = s=>document.querySelector(s);

    function toOptions(data, kind){
      if(kind === 'header'){
        return data.map(r => ({label: r['ジャンル'], prompt: r['Header Prompt']}));
      } else if(kind === 'intensity'){
        return data.map(r => ({label: r['label'], prompt: r['Template Prompt']}));
      } else if(kind === 'emotion'){
        return data.map(r => ({label: r['label'], prompt: r['Prompt']}));
      } else if(kind === 'outfit'){
        return data.map(r => ({label: r['label'], prompt: (r['outfit prompt']||[]).join(", ")}));
      } else if(kind === 'accessory'){
        return data.map(r => ({label: r['label'], prompt: r['prompt']}));
      } else {
        return data.map(r => ({label: r.label || r.label_ja || r.tag || '', prompt: r.prompt || r['keyword_en'] || r['Template Prompt'] || ''})).filter(o=>o.label);
      }
    }

    async function loadJSON(url){ const res=await fetch(url); return res.json(); }

    const urls={
      header:"https://ihmn18603-max.github.io/OD-Image-Generator/Main_Header_v1.0.0.json",
      intensity:"https://ihmn18603-max.github.io/OD-Image-Generator/Intensity_v1.0.0.json",
      emotion:"https://ihmn18603-max.github.io/OD-Image-Generator/Emotion_v1.0.4.json",
      extra:"https://ihmn18603-max.github.io/OD-Image-Generator/Extra_elements_v1.0.0.json",
      outfit:"https://ihmn18603-max.github.io/OD-Image-Generator/Outfit_v1.1.0.json",
      accessory:"https://ihmn18603-max.github.io/OD-Image-Generator/Accessory_v1.0.0.json"
    };

    const state={header:[],intensity:[],emotion:[],extra:[],outfit:[],accessory:[],sel:{extraChoices:{}}};

    function fill(sel,opts,multi=false){
      sel.innerHTML=multi?"":'<option value="">— 未選択 —</option>';
      opts.forEach((o,i)=>{
        const op=document.createElement('option');
        op.value=i; op.textContent=o.label; sel.appendChild(op);
      });
    }

    function build(){
      const parts=[];
      if(state.sel.header) parts.push(state.sel.header.prompt);
      if(state.sel.intensity) parts.push(state.sel.intensity.prompt);
      if(state.sel.emotion && state.sel.emotion.length){
        parts.push(state.sel.emotion.map(x=>x.prompt).join(", "));
      }
      if(state.sel.extraPrompt) parts.push(state.sel.extraPrompt);
      if(state.sel.accessory && state.sel.accessory.length){
        parts.push(state.sel.accessory.map(x=>x.prompt).join(", "));
      }
      // Outfitは結合プロンプトに含めない
      $('#out').value=parts.filter(Boolean).join(', ');
    }

    async function init(){
      state.header=toOptions(await loadJSON(urls.header),'header');
      state.intensity=toOptions(await loadJSON(urls.intensity),'intensity');
      state.emotion=toOptions(await loadJSON(urls.emotion),'emotion');
      state.extra=await loadJSON(urls.extra);
      state.outfit=toOptions(await loadJSON(urls.outfit),'outfit');
      state.accessory=toOptions(await loadJSON(urls.accessory),'accessory');

      fill($('#selHeader'),state.header);
      fill($('#selIntensity'),state.intensity);
      fill($('#selOutfit'),state.outfit);
      fill($('#selAccessory'),state.accessory,true);

      // Emotion用チェックボックス生成
      const emoBox=$('#emotionOptions');
      emoBox.innerHTML='';
      state.emotion.forEach((o,i)=>{
        const chk=document.createElement('input');
        chk.type='checkbox';
        chk.value=i;
        chk.id='emo'+i;
        chk.onchange=()=>{
          const selected=Array.from(document.querySelectorAll('#emotionOptions input:checked'));
          if(selected.length>4){
            chk.checked=false;
            return;
          }
          state.sel.emotion=selected.map(el=>state.emotion[el.value]);
          $('#emotionPrompt').textContent= state.sel.emotion.map(x=>x.prompt).join(", ");
          build();
        };
        const label=document.createElement('label');
        label.setAttribute('for','emo'+i);
        label.textContent=o.label;
        label.prepend(chk);
        emoBox.appendChild(label);
      });

      // Extra Elements ラジオボタン生成
      const categories=["eyes","mouth","tongue","saliva","pussy juice"];
      const extraBox=$('#extraRadios');
      categories.forEach(cat=>{
        const wrap=document.createElement('div');
        wrap.className='radio-group';
        wrap.innerHTML=`<strong>${cat}</strong>`;
        [0,1,2,3].forEach(val=>{
          const id=`${cat}_${val}`;
          const radio=document.createElement('input');
          radio.type='radio'; radio.name=cat; radio.value=val; radio.id=id;
          radio.onchange=()=>{
            state.sel.extraChoices[cat]=parseInt(val);
            matchExtra();
          };
          const label=document.createElement('label');
          label.setAttribute('for',id);
          label.textContent=val;
          label.prepend(radio);
          wrap.appendChild(label);
        });
        extraBox.appendChild(wrap);
      });
    }

    function matchExtra(){
      const c=state.sel.extraChoices;
      if(!c) return;
      const match=state.extra.find(e=>
        e.eyes==c["eyes"] &&
        e.mouth==c["mouth"] &&
        e.tongue==c["tongue"] &&
        e.saliva==c["saliva"] &&
        e["pussy juice"]==c["pussy juice"]
      );
      if(match){
        state.sel.extraPrompt=match.prompt;
        $('#extraPrompt').textContent=match.prompt;
      } else {
        state.sel.extraPrompt='';
        $('#extraPrompt').textContent='一致なし';
      }
      build();
    }

    $('#selHeader').addEventListener('change',e=>{
      state.sel.header=state.header[e.target.value];
      $('#headerPrompt').textContent= state.sel.header? state.sel.header.prompt : '';
      build();
    });
    $('#selIntensity').addEventListener('change',e=>{
      state.sel.intensity=state.intensity[e.target.value];
      $('#intensityPrompt').textContent= state.sel.intensity? state.sel.intensity.prompt : '';
      build();
    });
    $('#selOutfit').addEventListener('change',e=>{
      state.sel.outfit=state.outfit[e.target.value];
      $('#outfitPrompt').textContent= state.sel.outfit? state.sel.outfit.prompt : '';
    });
    $('#selAccessory').addEventListener('change',e=>{
      state.sel.accessory=Array.from(e.target.selectedOptions).map(o=>state.accessory[o.value]);
      $('#accessoryPrompt').textContent= state.sel.accessory.map(x=>x.prompt).join(", ");
      build();
    });

    $('#btnCopy').addEventListener('click',async()=>{
      try{await navigator.clipboard.writeText($('#out').value);$('#status').textContent='コピーしました！';}catch{ $('#status').textContent='コピー失敗'; }
    });
    $('#btnCopyOutfit').addEventListener('click',async()=>{
      try{await navigator.clipboard.writeText($('#outfitPrompt').textContent);$('#status').textContent='Outfitをコピーしました！';}catch{ $('#status').textContent='コピー失敗'; }
    });
    $('#btnCopyAccessory').addEventListener('click',async()=>{
      try{await navigator.clipboard.writeText($('#accessoryPrompt').textContent);$('#status').textContent='Accessoryをコピーしました！';}catch{ $('#status').textContent='コピー失敗'; }
    });

    init();
  </script>
</body>
</html>
