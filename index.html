<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OD_Image_Generator</title>
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#0f1520; color:#eee; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    h1 { margin:0 0 20px; text-align:center; }
    h2 { font-size:16px; margin:20px 0 8px; }
    select { width: 100%; padding:10px; border-radius:8px; border:1px solid #333; background:#0f1520; color:#eee; }
    textarea { width:100%; min-height:150px; margin-top:10px; border-radius:8px; border:1px solid #333; padding:10px; background:#0f1520; color:#eee; }
    button { padding:10px 16px; margin-top:10px; border:none; border-radius:8px; cursor:pointer; background:#1f7bf2; color:white; }
    .prompt-box { margin-top:8px; font-size:13px; color:#9ecbff; background:#121822; padding:8px; border-radius:6px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h1>OD_Image_Generator</h1>

    <h2>① Main Header（アニメ / リアル）</h2>
    <select id="selHeader"></select>
    <div id="headerPrompt" class="prompt-box"></div>

    <h2>② Intensity（シチュエーション）</h2>
    <select id="selIntensity"></select>
    <div id="intensityPrompt" class="prompt-box"></div>

    <h2>③ Emotion（表情）</h2>
    <select id="selEmotion"></select>
    <div id="emotionPrompt" class="prompt-box"></div>

    <h2>④ Extra Elements（付随要素・複数可）</h2>
    <select id="selExtra" multiple></select>

    <h2>結合プロンプト</h2>
    <textarea id="out" readonly placeholder="ここに結合プロンプトが出力されます"></textarea>
    <button id="btnCopy">コピー</button>
    <span id="status"></span>
  </div>

  <script>
    const $ = s=>document.querySelector(s);

    function toOptions(data, kind){
      if(kind === 'header'){
        return data.map(r => ({label: r['ジャンル'], prompt: r['Header Prompt']}));
      } else if(kind === 'intensity'){
        return data.map(r => ({label: r['label'], prompt: r['Template Prompt']}));
      } else if(kind === 'emotion'){
        return data.map(r => ({label: r['label'], prompt: r['Prompt']}));
      } else {
        return data.map(r => ({label: r.label || r.label_ja || r.tag || '', prompt: r.prompt || r['keyword_en'] || r['Template Prompt'] || ''})).filter(o=>o.label);
      }
    }

    async function loadJSON(url){ const res=await fetch(url); return res.json(); }

    const urls={
      header:"https://ihmn18603-max.github.io/OD-Image-Generator/Main_Header_v1.0.0.json",
      intensity:"https://ihmn18603-max.github.io/OD-Image-Generator/Intensity_v1.0.0.json",
      emotion:"https://ihmn18603-max.github.io/OD-Image-Generator/Emotion_v1.0.4.json",
      extra:"https://ihmn18603-max.github.io/OD-Image-Generator/Extra_elements_v1.0.0.json"
    };

    const state={header:[],intensity:[],emotion:[],extra:[],sel:{}};

    function fill(sel,opts,multi=false){
      sel.innerHTML=multi?"":'<option value="">— 未選択 —</option>';
      opts.forEach((o,i)=>{
        const op=document.createElement('option');
        op.value=i; op.textContent=o.label; sel.appendChild(op);
      });
    }

    function build(){
      const parts=[];
      if(state.sel.header) parts.push(state.sel.header.prompt);
      if(state.sel.intensity) parts.push(state.sel.intensity.prompt);
      if(state.sel.emotion) parts.push(state.sel.emotion.prompt);
      if(state.sel.extra&&state.sel.extra.length) parts.push(state.sel.extra.map(x=>x.prompt).join(", "));
      $('#out').value=parts.filter(Boolean).join(', ');
    }

    async function init(){
      state.header=toOptions(await loadJSON(urls.header),'header');
      state.intensity=toOptions(await loadJSON(urls.intensity),'intensity');
      state.emotion=toOptions(await loadJSON(urls.emotion),'emotion');
      state.extra=toOptions(await loadJSON(urls.extra));

      fill($('#selHeader'),state.header);
      fill($('#selIntensity'),state.intensity);
      fill($('#selEmotion'),state.emotion);
      fill($('#selExtra'),state.extra,true);
    }

    $('#selHeader').addEventListener('change',e=>{
      state.sel.header=state.header[e.target.value];
      $('#headerPrompt').textContent= state.sel.header? state.sel.header.prompt : '';
      build();
    });
    $('#selIntensity').addEventListener('change',e=>{
      state.sel.intensity=state.intensity[e.target.value];
      $('#intensityPrompt').textContent= state.sel.intensity? state.sel.intensity.prompt : '';
      build();
    });
    $('#selEmotion').addEventListener('change',e=>{
      state.sel.emotion=state.emotion[e.target.value];
      $('#emotionPrompt').textContent= state.sel.emotion? state.sel.emotion.prompt : '';
      build();
    });
    $('#selExtra').addEventListener('change',e=>{state.sel.extra=Array.from(e.target.selectedOptions).map(o=>state.extra[o.value]);build();});

    $('#btnCopy').addEventListener('click',async()=>{
      try{await navigator.clipboard.writeText($('#out').value);$('#status').textContent='コピーしました！';}catch{ $('#status').textContent='コピー失敗'; }
    });

    init();
  </script>
</body>
</html>
