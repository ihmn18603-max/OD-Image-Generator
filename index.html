<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OD Model Generator</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      padding: 10px;
      max-width: 700px;
      margin: auto;
    }
    select, textarea, button, input {
      font-size: 14px;
    }
    select, input {
      margin: 10px 0;
      padding: 6px;
      background-color: #111;
      color: #fff;
      border: 1px solid #444;
      width: 100%;
      box-sizing: border-box;
    }
    .accordion {
      margin-bottom: 10px;
      border: 1px solid #444;
      border-radius: 6px;
      overflow: hidden;
    }
    .accordion-header {
      background-color: #222;
      padding: 12px;
      cursor: pointer;
      font-weight: bold;
    }
    .accordion-header:hover {
      background-color: #333;
    }
    .accordion-content {
      display: none;
      padding: 10px;
      background-color: #111;
    }
    .prompt-block {
      margin-bottom: 20px;
      padding: 10px;
    }
    textarea {
      width: 100%;
      height: 80px;
      padding: 8px;
      margin-top: 5px;
      background-color: #222;
      color: #fff;
      border: 1px solid #555;
      box-sizing: border-box;
      font-size: 14px;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .button-group button {
      flex: 1;
      padding: 10px;
      cursor: pointer;
      background-color: #333;
      color: #fff;
      border: 1px solid #666;
      border-radius: 4px;
      text-align: center;
    }
    .button-group button:hover {
      background-color: #444;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ OD Model Generator</h1>

  <!-- å›½ç± -->
  <div class="accordion">
    <div class="accordion-header">ğŸŒ Nationality</div>
    <div class="accordion-content" style="display:block;">
      <div id="prompt-container">å›½ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>
    </div>
  </div>

  <!-- Fetish -->
  <div class="accordion">
    <div class="accordion-header">ğŸ” Fetish</div>
    <div class="accordion-content">
      <div id="fetish-container">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>
    </div>
  </div>

  <!-- Other -->
  <div class="accordion">
    <div class="accordion-header">ğŸŒ€ Other</div>
    <div class="accordion-content">
      <div id="other-container">ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>
    </div>
  </div>

  <script>
    // --- Accordion toggle (ä¸€ã¤ã ã‘é–‹ã‘ã‚‹æ–¹å¼) ---
    document.querySelectorAll(".accordion-header").forEach(header => {
      header.addEventListener("click", () => {
        document.querySelectorAll(".accordion-content").forEach(c => c.style.display = "none");
        const content = header.nextElementSibling;
        content.style.display = "block";
      });
    });

    async function loadJSON(url) {
      const response = await fetch(url);
      if (!response.ok) throw new Error("Failed to load JSON");
      return await response.json();
    }

    // --- Nationality ---
    function renderPrompts(data, selectedCode = "") {
      const container = document.getElementById("prompt-container");
      container.innerHTML = "";

      const select = document.createElement("select");
      select.innerHTML = `<option value="">å›½ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</option>`;
      const codes = [...new Set(data.map(entry => entry.code))];
      codes.forEach(code => {
        const option = document.createElement("option");
        option.value = code;
        option.textContent = code;
        select.appendChild(option);
      });
      container.appendChild(select);

      const resultDiv = document.createElement("div");
      container.appendChild(resultDiv);

      select.addEventListener("change", () => {
        resultDiv.innerHTML = "";
        const entry = data.find(e => e.code === select.value);
        if (!entry) return;

        // åŸºæœ¬æƒ…å ±
        const info = document.createElement("p");
        info.innerHTML = `
          <strong>å›½å:</strong> ${entry.label || ""}<br>
          <strong>Base Aura:</strong> ${entry["base_aura"] || ""}<br>
          <strong>Base Skin:</strong> ${entry["base_skin"] || ""}<br>
          <strong>Figure Structure:</strong> ${entry["figure_structure"] || ""}<br>
          <strong>Face Structure:</strong> ${entry["face_structure"] || ""}<br>
          <strong>Notes:</strong> ${entry["notes"] || ""}<br>
        `;
        resultDiv.appendChild(info);

        // Personality / Physical / Facial
        ["Personality","Physical Prompt","Facial Prompt"].forEach(key => {
          const label = document.createElement("strong");
          label.textContent = key.replace(" Prompt",""); 
          resultDiv.appendChild(label);

          const ta = document.createElement("textarea");
          ta.readOnly = true;
          ta.textContent = entry[key] || "";
          resultDiv.appendChild(ta);

          const btnGroup = document.createElement("div");
          btnGroup.className = "button-group";
          const btn = document.createElement("button");
          btn.textContent = `Copy ${label.textContent}`;
          btn.onclick = () => {
            navigator.clipboard.writeText(ta.value)
              .then(() => alert(`âœ… ${label.textContent} ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼`))
              .catch(() => alert("âš ï¸ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ"));
          };
          btnGroup.appendChild(btn);
          resultDiv.appendChild(btnGroup);
        });
      });
    }
    loadJSON("ODnationality_v1.0.0.json").then(data => renderPrompts(data));

    // --- Fetish ---
    async function loadFetish(url) {
      const data = await loadJSON(url);
      const container = document.getElementById("fetish-container");

      // é¸æŠçŠ¶æ…‹ã‚’ä¿å­˜ã™ã‚‹ Set
      const selectedPrompts = new Set();

      // --- Category ã‚»ãƒ¬ã‚¯ãƒˆ ---
      const categories = [...new Set(data.map(e => e.category))];
      const catSelect = document.createElement("select");
      catSelect.innerHTML = `<option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</option>`;
      categories.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        catSelect.appendChild(option);
      });
      container.appendChild(catSelect);

      const listDiv = document.createElement("div");
      container.appendChild(listDiv);

      // --- æœ€å¤§é¸æŠæ•°å…¥åŠ› & é¸æŠæ•°è¡¨ç¤º ---
      const settingsDiv = document.createElement("div");
      settingsDiv.style.margin = "10px 0";

      const maxLabel = document.createElement("label");
      maxLabel.textContent = "æœ€å¤§é¸æŠæ•°: ";
      const maxInput = document.createElement("input");
      maxInput.type = "number";
      maxInput.value = 5;
      maxInput.min = 1;
      maxInput.style.width = "80px";

      const countDisplay = document.createElement("span");
      countDisplay.style.marginLeft = "10px";
      countDisplay.textContent = `é¸æŠä¸­: 0 / ${maxInput.value}`;

      settingsDiv.appendChild(maxLabel);
      settingsDiv.appendChild(maxInput);
      settingsDiv.appendChild(countDisplay);

      container.appendChild(settingsDiv);

      // --- å‡ºåŠ›ã‚¨ãƒªã‚¢ & ãƒœã‚¿ãƒ³ ---
      const resultArea = document.createElement("textarea");
      resultArea.readOnly = true;
      container.appendChild(resultArea);

      const copyBtn = document.createElement("button");
      copyBtn.textContent = "Copy Fetish Prompts";
      container.appendChild(copyBtn);

      // --- é¸æŠæ•°æ›´æ–°é–¢æ•° ---
      function updateCountDisplay() {
        const MAX_FETISH = parseInt(maxInput.value, 10) || 5;
        countDisplay.textContent = `é¸æŠä¸­: ${selectedPrompts.size} / ${MAX_FETISH}`;
      }

      // --- ãƒªã‚¹ãƒˆæç”»é–¢æ•° ---
      function renderList(category) {
        listDiv.innerHTML = "";
        const filtered = category ? data.filter(e => e.category === category) : data;

        filtered.forEach(entry => {
          const label = document.createElement("label");
          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.value = entry.prompt;
          cb.checked = selectedPrompts.has(entry.prompt);

          cb.onchange = () => {
            const MAX_FETISH = parseInt(maxInput.value, 10) || 5;
            if (cb.checked) {
              if (selectedPrompts.size >= MAX_FETISH) {
                cb.checked = false;
                alert(`âš ï¸ é¸æŠã¯æœ€å¤§ ${MAX_FETISH} å€‹ã¾ã§ã§ã™`);
                return;
              }
              selectedPrompts.add(entry.prompt);
            } else {
              selectedPrompts.delete(entry.prompt);
            }
            updateCountDisplay();
          };

          label.appendChild(cb);
          label.appendChild(document.createTextNode(`${entry.label}`));
          listDiv.appendChild(label);
          listDiv.appendChild(document.createElement("br"));
        });
      }

      // åˆæœŸè¡¨ç¤ºï¼ˆå…¨ã‚«ãƒ†ã‚´ãƒªï¼‰
      renderList("");
      updateCountDisplay();

      // ã‚«ãƒ†ã‚´ãƒªåˆ‡ã‚Šæ›¿ãˆ
      catSelect.addEventListener("change", () => {
        renderList(catSelect.value);
      });

      // æœ€å¤§é¸æŠæ•°å¤‰æ›´æ™‚ã«æ›´æ–°
      maxInput.addEventListener("input", updateCountDisplay);

      // ã‚³ãƒ”ãƒ¼
      copyBtn.onclick = () => {
        const prompts = Array.from(selectedPrompts).join(", ");
        resultArea.value = prompts;
        navigator.clipboard.writeText(prompts)
          .then(() => alert("âœ… Fetish prompts ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"))
          .catch(() => alert("âš ï¸ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ"));
      };
    }
    loadFetish("Fetish_v1.0.1.json");

    // --- Other ---
    async function loadOther(url) {
      const data = await loadJSON(url);
      const container = document.getElementById("other-container");

      const select = document.createElement("select");
      select.innerHTML = `<option value="">ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ</option>`;
      data.forEach(entry => {
        const option = document.createElement("option");
        option.value = entry["ã‚¿ã‚¤ãƒ—"];
        option.textContent = entry["ã‚¿ã‚¤ãƒ—"];
        select.appendChild(option);
      });
      container.appendChild(select);

      const detailsArea = document.createElement("textarea");
      detailsArea.placeholder = "Additional Personality Details";
      detailsArea.readOnly = true;
      container.appendChild(detailsArea);

      const scenarioArea = document.createElement("textarea");
      scenarioArea.placeholder = "Scenario";
      scenarioArea.readOnly = true;
      container.appendChild(scenarioArea);

      const btnGroup = document.createElement("div");
      btnGroup.className = "button-group";
      container.appendChild(btnGroup);

      const copyDetails = document.createElement("button");
      copyDetails.textContent = "Copy Details";
      btnGroup.appendChild(copyDetails);

      const copyScenario = document.createElement("button");
      copyScenario.textContent = "Copy Scenario";
      btnGroup.appendChild(copyScenario);

      select.addEventListener("change", () => {
        const entry = data.find(e => e["ã‚¿ã‚¤ãƒ—"] === select.value);
        detailsArea.value = entry ? entry["Additional Personality Details"] : "";
        scenarioArea.value = entry ? entry["Scenario"] : "";
      });

      copyDetails.onclick = () => navigator.clipboard.writeText(detailsArea.value)
        .then(() => alert("âœ… Details ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"))
        .catch(() => alert("âš ï¸ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ"));

      copyScenario.onclick = () => navigator.clipboard.writeText(scenarioArea.value)
        .then(() => alert("âœ… Scenario ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"))
        .catch(() => alert("âš ï¸ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ"));
    }
    loadOther("Other_v1.0.0.json");
  </script>
</body>
</html>
