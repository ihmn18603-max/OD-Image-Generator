<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OD Image Generator</title>
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#0f1520; color:#eee; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    h1 { margin:0 0 20px; text-align:center; }
    h2 { font-size:16px; margin:20px 0 8px; }
    select { width: 100%; padding:10px; border-radius:8px; border:1px solid #333; background:#0f1520; color:#eee; }
    textarea { width:100%; min-height:150px; margin-top:10px; border-radius:8px; border:1px solid #333; padding:10px; background:#0f1520; color:#eee; }
    button { padding:10px 16px; margin-top:10px; border:none; border-radius:8px; cursor:pointer; background:#1f7bf2; color:white; }
    .prompt-box { margin-top:8px; font-size:13px; color:#9ecbff; background:#121822; padding:8px; border-radius:6px; white-space:pre-wrap; }
    .radio-group { margin:8px 0; }
    .radio-group label { margin-right:12px; }
    .emotion-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; }
    .emotion-btn { padding:8px; border:1px solid #444; border-radius:6px; text-align:center; cursor:pointer; background:#1a1f2e; }
    .emotion-btn.active { background:#1f7bf2; color:white; border-color:#1f7bf2; }
    details summary { cursor:pointer; margin:8px 0; }
    hr { border:none; border-top:1px solid #333; margin:24px 0; }
    span.status { margin-left:10px; font-size:13px; color:#9ecbff; }
  </style>
</head>
<body>
  <div class="container">
    <h1>OD Image Generator</h1>

    <h2>① Main Header（アニメ / リアル）</h2>
    <select id="selHeader"></select>
    <div id="headerPrompt" class="prompt-box"></div>

    <h2>② Intensity（シチュエーション）</h2>
    <select id="selIntensity"></select>
    <div id="intensityPrompt" class="prompt-box"></div>

    <h2>③ Emotion（表情・最大4つ選択可）</h2>
    <div id="emotionOptions" class="emotion-grid"></div>
    <div id="emotionPrompt" class="prompt-box"></div>

    <h2>④ Extra Elements（Eyes / Mouth / Tongue / Saliva / Pussy Juice）</h2>
    <div id="extraElements"></div>
    <div id="extraPrompt" class="prompt-box"></div>

    <h2>⑤ Custom Prompt (①〜④結合)</h2>
    <textarea id="out" readonly placeholder="ここに結合プロンプトが出力されます"></textarea>
    <div id="charCount">文字数: 0</div>
    <button id="btnCopy">コピー</button><span id="statusCustom" class="status"></span>

    <hr>

    <h2>⑥ Outfit（衣装）</h2>
    <select id="selOutfit"></select>
    <div id="outfitPrompt" class="prompt-box"></div>

    <h2>⑦ Accessory（複数選択可）</h2>
    <select id="selAccessory" multiple></select>
    <div id="accessoryPrompt" class="prompt-box"></div>

    <h2>⑧ Outfit Prompt (⑥⑦結合)</h2>
    <textarea id="outfitAccessoryOut" readonly placeholder="ここにOutfit+Accessory結合プロンプトが出力されます"></textarea>
    <button id="btnCopyOutfitAccessory">コピー</button><span id="statusOutfit" class="status"></span>

    <hr>

    <h2>⑨ Negative Prompt</h2>
    <button id="btnCopyNeg">コピー</button><span id="statusNeg" class="status"></span>
    <details>
      <summary>Negative Prompt を表示</summary>
      <textarea id="negPrompt" readonly>
(worst quality, low quality:1.4), blurry,
bad anatomy, unrealistic anatomy, malformed body, unnatural body, deformed, disfigured,
bad hands, mutated hands, extra digits, missing fingers, fused fingers, long fingers,
bad legs, short legs, stumpy legs, deformed legs,
extra arms, extra legs, missing arms, long neck,
extra body, extra person, multiple people, extra head, extra hand, extra leg, cloned face,
mutated pussy, malformed pussy, fused vagina, extra holes, double vagina, unrealistic pussy,
large areolae, oversized nipples, puffy nipples, stretched nipples,
obese, fat, overweight, flabby, saggy breasts, huge breasts, balloon breasts, gigantic breasts
      </textarea>
    </details>
  </div>

  <script>
    const $ = s=>document.querySelector(s);

    function toOptions(data, kind){
      if(kind === 'header'){
        return data.map(r => ({label: r['label'], prompt: r['Header Prompt']}));
      } else if(kind === 'intensity'){
        return data.map(r => ({label: r['label'], prompt: r['Template Prompt']}));
      } else if(kind === 'emotion'){
        return data.map(r => ({label: r['label'], prompt: r['Prompt']}));
      } else if(kind === 'outfit'){
        return data.map(r => ({label: r['label'], prompt: (r['outfit prompt']||[]).join(", ")}));
      } else if(kind === 'accessory'){
        return data.map(r => ({label: r['label'], prompt: r['prompt']}));
      } else {
        return data.map(r => ({
          label: r['label'] || r['tag'] || '',
          prompt: r['prompt'] || r['Template Prompt'] || ''
        })).filter(o=>o.label);
      }
    }

    async function loadJSON(url){ const res=await fetch(url); return res.json(); }

    const urls={
      header:"https://ihmn18603-max.github.io/OD-Image-Generator/Main_Header_v1.0.0.json",
      intensity:"https://ihmn18603-max.github.io/OD-Image-Generator/Intensity_v1.0.0.json",
      emotion:"https://ihmn18603-max.github.io/OD-Image-Generator/Emotion_v1.0.4.json",
      extra:"https://ihmn18603-max.github.io/OD-Image-Generator/Extra_elements_v1.0.1.json",
      outfit:"https://ihmn18603-max.github.io/OD-Image-Generator/Outfit_v1.0.1.json",
      accessory:"https://ihmn18603-max.github.io/OD-Image-Generator/Accessory_v1.0.1.json"
    };

    const state={header:[],intensity:[],emotion:[],extra:[],outfit:[],accessory:[],sel:{extraChoices:{}}};

    function fill(sel,opts,multi=false){
      sel.innerHTML=multi?"":'<option value="">— 未選択 —</option>';
      opts.forEach((o,i)=>{
        const op=document.createElement('option');
        op.value=i; op.textContent=o.label; sel.appendChild(op);
      });
    }

    function build(){
      const parts=[];
      if(state.sel.header) parts.push(state.sel.header.prompt);
      if(state.sel.intensity) parts.push(state.sel.intensity.prompt);
      if(state.sel.emotion && state.sel.emotion.length){
        parts.push(state.sel.emotion.map(x=>x.prompt).join(", "));
      }
      if(state.sel.extraPrompts && state.sel.extraPrompts.length){
        parts.push(state.sel.extraPrompts.join(", "));
      }
      const result = parts.filter(Boolean).join(', ');
      $('#out').value = result;
      $('#charCount').textContent = `文字数: ${result.length}`;

      const outfitAccessory=[];
      if(state.sel.outfit) outfitAccessory.push(state.sel.outfit.prompt);
      if(state.sel.accessory && state.sel.accessory.length){
        outfitAccessory.push(state.sel.accessory.map(x=>x.prompt).join(", "));
      }
      $('#outfitAccessoryOut').value=outfitAccessory.filter(Boolean).join(', ');
    }

    async function init(){
      state.header=toOptions(await loadJSON(urls.header),'header');
      state.intensity=toOptions(await loadJSON(urls.intensity),'intensity');
      state.emotion=toOptions(await loadJSON(urls.emotion),'emotion');
      state.extra=await loadJSON(urls.extra);
      state.outfit=toOptions(await loadJSON(urls.outfit),'outfit');
      state.accessory=toOptions(await loadJSON(urls.accessory),'accessory');

      fill($('#selHeader'),state.header);
      fill($('#selIntensity'),state.intensity);
      fill($('#selOutfit'),state.outfit);
      fill($('#selAccessory'),state.accessory,true);

      // Emotion ボタン生成
      const emoBox=$('#emotionOptions');
      emoBox.innerHTML='';
      state.emotion.forEach((o,i)=>{
        const btn=document.createElement('div');
        btn.className='emotion-btn';
        btn.textContent=o.label;
        btn.onclick=()=>{
          if(btn.classList.contains('active')){
            btn.classList.remove('active');
          } else {
            const active=document.querySelectorAll('.emotion-btn.active');
            if(active.length>=4){
              return;
            }
            btn.classList.add('active');
          }
          const selected=[...document.querySelectorAll('.emotion-btn.active')].map(b=>{
            const obj=state.emotion.find(x=>x.label===b.textContent);
            return obj;
          });
          state.sel.emotion=selected;
          $('#emotionPrompt').textContent=selected.map(x=>x.prompt).join(", ");
          build();
        };
        emoBox.appendChild(btn);
      });

      // Extra Elements ラジオボタン生成
      const container=$('#extraElements');
      const grouped={};
      state.extra.forEach(item=>{
        if(!grouped[item.tag]) grouped[item.tag]=[];
        grouped[item.tag].push(item);
      });

      Object.keys(grouped).forEach(tag=>{
        const wrap=document.createElement('div');
        wrap.className='radio-group';
        wrap.innerHTML=`<strong>${tag}</strong><br>`;
        grouped[tag].forEach(opt=>{
          const id=`${tag}_${opt.level}`;
          const radio=document.createElement('input');
          radio.type='radio';
          radio.name=tag;
          radio.value=opt.prompt;
          radio.id=id;
          radio.onchange=()=>{
            state.sel.extraChoices[tag]=opt.prompt;
            state.sel.extraPrompts=Object.values(state.sel.extraChoices).filter(Boolean);
            $('#extraPrompt').textContent=state.sel.extraPrompts.join(", ");
            build();
          };
          const label=document.createElement('label');
          label.setAttribute('for',id);
          label.textContent=opt.label;
          label.prepend(radio);
          wrap.appendChild(label);
        });
        container.appendChild(wrap);
      });
    }

    $('#selHeader').addEventListener('change',e=>{
      state.sel.header=state.header[e.target.value];
      $('#headerPrompt').textContent= state.sel.header? state.sel.header.prompt : '';
      build();
    });
    $('#selIntensity').addEventListener('change',e=>{
      state.sel.intensity=state.intensity[e.target.value];
      $('#intensityPrompt').textContent= state.sel.intensity? state.sel.intensity.prompt : '';
      build();
    });
    $('#selOutfit').addEventListener('change',e=>{
      state.sel.outfit=state.outfit[e.target.value];
      $('#outfitPrompt').textContent= state.sel.outfit? state.sel.outfit.prompt : '';
      build();
    });
    $('#selAccessory').addEventListener('change',e=>{
      state.sel.accessory=Array.from(e.target.selectedOptions).map(o=>state.accessory[parseInt(o.value)]);
      $('#accessoryPrompt').textContent= state.sel.accessory.map(x=>x.prompt).join(", ");
      build();
    });

    $('#btnCopy').addEventListener('click',async()=>{
      try{await navigator.clipboard.writeText($('#out').value);$('#statusCustom').textContent='コピーしました！';}catch{ $('#statusCustom').textContent='コピー失敗'; }
    });
    $('#btnCopyOutfitAccessory').addEventListener('click',async()=>{
      try{await navigator.clipboard.writeText($('#outfitAccessoryOut').value);$('#statusOutfit').textContent='Outfit Promptをコピーしました！';}catch{ $('#statusOutfit').textContent='コピー失敗'; }
    });
    $('#btnCopyNeg').addEventListener('click',async()=>{
      try{await navigator.clipboard.writeText($('#negPrompt').value);$('#statusNeg').textContent='Negative Promptをコピーしました！';}catch{ $('#statusNeg').textContent='コピー失敗'; }
    });

    init();
  </script>
</body>
</html>
