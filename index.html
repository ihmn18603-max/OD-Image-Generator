<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OD Image Generator</title>
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background:#0f1520; color:#eee; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    h1 { margin:0 0 20px; text-align:center; }
    h2 { font-size:16px; margin:20px 0 8px; }
    select, textarea, button { font-size:14px; }
    select { width: 100%; padding:10px; border-radius:8px; border:1px solid #333; background:#0f1520; color:#eee; }
    textarea { width:100%; min-height:150px; margin-top:10px; border-radius:8px; border:1px solid #333; padding:10px; background:#0f1520; color:#eee; }
    button { padding:10px 16px; margin-top:10px; border:none; border-radius:8px; cursor:pointer; background:#1f7bf2; color:white; }
    .prompt-box { margin-top:8px; font-size:13px; color:#9ecbff; background:#121822; padding:8px; border-radius:6px; white-space:pre-wrap; }
    .emotion-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; }
    .emotion-btn { padding:8px; border:1px solid #444; border-radius:6px; text-align:center; cursor:pointer; background:#1a1f2e; }
    .emotion-btn.active { background:#1f7bf2; color:white; border-color:#1f7bf2; }
    .radio-group { margin:12px 0; }
    .radio-group label { display:inline-block; margin:4px; cursor:pointer; }
    .radio-group input[type="radio"] { display:none; }
    .radio-group span {
      display:inline-block;
      padding:8px 14px;
      border:1px solid #444;
      border-radius:8px;
      background:#1a1f2e;
      color:#eee;
      transition:0.2s;
      user-select:none;
    }
    .radio-group span:hover { background:#243048; border-color:#1f7bf2; }
    .radio-group input[type="radio"]:checked + span {
      background:#1f7bf2;
      border-color:#1f7bf2;
      color:white;
      box-shadow:0 0 8px rgba(31,123,242,0.6);
    }
    details summary { cursor:pointer; margin:8px 0; }
    hr { border:none; border-top:1px solid #333; margin:24px 0; }
    span.status { margin-left:10px; font-size:13px; color:#9ecbff; }
  </style>
</head>
<body>
  <div class="container">
    <h1>OD Image Generator</h1>

    <h2>① Main Header（アニメ / リアル）</h2>
    <select id="selHeader"></select>
    <div id="headerPrompt" class="prompt-box"></div>

    <h2>② Intensity（シチュエーション）</h2>
    <select id="selIntensity"></select>
    <div id="intensityPrompt" class="prompt-box"></div>

    <h2>③ Emotion（表情・最大4つ選択可）</h2>
    <div id="emotionOptions" class="emotion-grid"></div>
    <div id="emotionPrompt" class="prompt-box"></div>

    <h2>④ Extra Elements（Eyes / Mouth / Tongue / Saliva / Pussy Juice）</h2>
    <div id="extraElements"></div>
    <div id="extraPrompt" class="prompt-box"></div>

    <h2>⑤ Custom Prompt (①〜④結合)</h2>
    <textarea id="out" readonly placeholder="ここに結合プロンプトが出力されます"></textarea>
    <div id="charCount">文字数: 0</div>
    <button id="btnCopy">コピー</button><span id="statusCustom" class="status"></span>

    <hr>

    <h2>⑥ Outfit（衣装）</h2>
    <select id="selOutfit"></select>
    <div id="outfitPrompt" class="prompt-box"></div>

    <h2>⑦ Accessory（複数選択可）</h2>
    <select id="selAccessory" multiple></select>
    <div id="accessoryPrompt" class="prompt-box"></div>

    <h2>⑧ Outfit Prompt (⑥⑦結合)</h2>
    <textarea id="outfitAccessoryOut" readonly placeholder="ここにOutfit+Accessory結合プロンプトが出力されます"></textarea>
    <button id="btnCopyOutfitAccessory">コピー</button><span id="statusOutfit" class="status"></span>

    <hr>

    <h2>⑨ Negative Prompt</h2>
    <button id="btnCopyNeg">コピー</button><span id="statusNeg" class="status"></span>
    <details>
      <summary>Negative Prompt を表示</summary>
      <textarea id="negPrompt" readonly>
(worst quality, low quality:1.4), blurry, 
bad anatomy, unrealistic anatomy, malformed body, unnatural body, deformed, disfigured, 
bad hands, mutated hands, extra digits, missing fingers, fused fingers, long fingers, 
bad legs, short legs, stumpy legs, deformed legs, 
extra arms, extra legs, missing arms, long neck, 
extra body, extra person, multiple people, extra head, extra hand, extra leg, cloned face, 
mutated pussy, malformed pussy, fused vagina, extra holes, double vagina, unrealistic pussy, 
large areolae, oversized nipples, puffy nipples, stretched nipples, 
obese, fat, overweight, flabby, saggy breasts, huge breasts, balloon breasts, gigantic breasts
      </textarea>
    </details>
  </div>

  <script>
    const $ = s=>document.querySelector(s);

    function toOptions(data){ return data.map(r => ({ label: r['label'], prompt: r['prompt'] })); }
    async function loadJSON(url){ const res=await fetch(url); return res.json(); }

    const base = "https://ihmn18603-max.github.io/OD-Image-Generator/";
    const urls={
      header: base + "Main_Header_v1.0.1.json",
      intensity: base + "Intensity_v1.0.1.json",
      emotion: base + "Emotion_v1.0.5.json",
      extra: base + "Extra_elements_v1.0.2.json",
      outfit: base + "Cloth_v1.0.2.json",
      accessory: base + "Accessory_v1.0.2.json"
    };

    const state={header:[],intensity:[],emotion:[],extra:[],outfit:[],accessory:[],sel:{extraChoices:{}}};

    function fill(sel,opts,multi=false){
      sel.innerHTML=multi?"":'<option value="">— 未選択 —</option>';
      opts.forEach((o,i)=>{
        const op=document.createElement('option');
        op.value=i; op.textContent=o.label; sel.appendChild(op);
      });
    }

    function build(){
      const parts=[];
      if(state.sel.header) parts.push(state.sel.header.prompt);
      if(state.sel.intensity) parts.push(state.sel.intensity.prompt);
      if(state.sel.emotion && state.sel.emotion.length){
        parts.push(state.sel.emotion.map(x=>x.prompt).join(", "));
      }
      if(state.sel.extraPrompts && state.sel.extraPrompts.length){
        parts.push(state.sel.extraPrompts.join(", "));
      }
      const result = parts.filter(Boolean).join(', ');
      $('#out').value = result;
      $('#charCount').textContent = `文字数: ${result.length}`;

      const outfitAccessory=[];
      if(state.sel.outfit) outfitAccessory.push(state.sel.outfit.prompt);
      if(state.sel.accessory && state.sel.accessory.length){
        outfitAccessory.push(state.sel.accessory.map(x=>x.prompt).join(", "));
      }
      $('#outfitAccessoryOut').value=outfitAccessory.filter(Boolean).join(', ');
    }

    async function init(){
      state.header=toOptions(await loadJSON(urls.header));
      state.intensity=toOptions(await loadJSON(urls.intensity));
      state.emotion=toOptions(await loadJSON(urls.emotion));
      state.extra=await loadJSON(urls.extra);
      state.outfit=toOptions(await loadJSON(urls.outfit));
      state.accessory=toOptions(await loadJSON(urls.accessory));

      fill($('#selHeader'),state.header);
      fill($('#selIntensity'),state.intensity);
      fill($('#selOutfit'),state.outfit);
      fill($('#selAccessory'),state.accessory,true);

      // Emotion ボタン生成
      const emoBox=$('#emotionOptions');
      emoBox.innerHTML='';
      state.emotion.forEach((o)=>{
        const btn=document.createElement('div');
        btn.className='emotion-btn';
        btn.textContent=o.label;
        btn.onclick=()=>{
          if(btn.classList.contains('active')) btn.classList.remove('active');
          else if(document.querySelectorAll('.emotion-btn.active').length<4) btn.classList.add('active');
          const selected=[...document.querySelectorAll('.emotion-btn.active')].map(b=>state.emotion.find(x=>x.label===b.textContent));
          state.sel.emotion=selected;
          $('#emotionPrompt').textContent=selected.map(x=>x.prompt).join(", ");
          build();
        };
        emoBox.appendChild(btn);
      });

      // Extra Elements ボタン生成
      const container=$('#extraElements');
      const grouped={};
      state.extra.forEach(item=>{
        if(!grouped[item.category]) grouped[item.category]=[];
        grouped[item.category].push(item);
      });

      Object.keys(grouped).forEach(cat=>{
        const wrap=document.createElement('div');
        wrap.className='radio-group';
        wrap.innerHTML=`<strong>${cat}</strong><br>`;
        grouped[cat].forEach(opt=>{
          const id=`${cat}_${opt["category level"]}`;
          const radio=document.createElement('input');
          radio.type='radio'; radio.name=cat; radio.id=id; radio.value=opt.prompt;
          radio.onchange=()=>{
            state.sel.extraChoices[cat]=opt.prompt;
            state.sel.extraPrompts=Object.values(state.sel.extraChoices).filter(Boolean);
            $('#extraPrompt').textContent=state.sel.extraPrompts.join(", ");
            build();
          };
          const label=document.createElement('label');
          label.setAttribute('for',id);
          const span=document.createElement('span');
          span.textContent=opt.label;
          label.appendChild(radio);
          label.appendChild(span);
          wrap.appendChild(label);
        });
        container.appendChild(wrap);
      });
    }

    // イベント
    $('#selHeader').addEventListener('change',e=>{ state.sel.header=state.header[e.target.value]; $('#headerPrompt').textContent= state.sel.header? state.sel.header.prompt : ''; build(); });
    $('#selIntensity').addEventListener('change',e=>{ state.sel.intensity=state.intensity[e.target.value]; $('#intensityPrompt').textContent= state.sel.intensity? state.sel.intensity.prompt : ''; build(); });
    $('#selOutfit').addEventListener('change',e=>{ state.sel.outfit=state.outfit[e.target.value]; $('#outfitPrompt').textContent= state.sel.outfit? state.sel.outfit.prompt : ''; build(); });
    $('#selAccessory').addEventListener('change',e=>{ state.sel.accessory=Array.from(e.target.selectedOptions).map(o=>state.accessory[parseInt(o.value)]); $('#accessoryPrompt').textContent= state.sel.accessory.map(x=>x.prompt).join(", "); build(); });

    $('#btnCopy').addEventListener('click',async()=>{ try{await navigator.clipboard.writeText($('#out').value);$('#statusCustom').textContent='コピーしました！';}catch{ $('#statusCustom').textContent='コピー失敗'; } });
    $('#btnCopyOutfitAccessory').addEventListener('click',async()=>{ try{await navigator.clipboard.writeText($('#outfitAccessoryOut').value);$('#statusOutfit').textContent='Outfit Promptをコピーしました！';}catch{ $('#statusOutfit').textContent='コピー失敗'; } });
    $('#btnCopyNeg').addEventListener('click',async()=>{ try{await navigator.clipboard.writeText($('#negPrompt').value);$('#statusNeg').textContent='Negative Promptをコピーしました！';}catch{ $('#statusNeg').textContent='コピー失敗'; } });

    init();
  </script>
</body>
</html>
